!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("angular")):"function"==typeof define&&define.amd?define(["angular"],t):(e=e||self).fluxAngular=t(e.angular)}(this,function(a){"use strict";a=a&&a.hasOwnProperty("default")?a.default:a;function t(e){return c.call(e).slice(8,-1)}function i(e){return"object"==typeof e?null!==e:"function"==typeof e}function r(e){if(null==e)throw TypeError("Can't call method on "+e);return e}function b(e){return Object(r(e))}function f(e){return isNaN(e=+e)?0:(0<e?p:h)(e)}function w(e){return 0<e?y(f(e),9007199254740991):0}function o(e,t){if(!i(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!i(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!i(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!i(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")}function n(e){try{return!!e()}catch(e){return!0}}function s(e){if(!i(e))throw TypeError(String(e)+" is not an object");return e}function u(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function d(e,t,r){var n=o(t);n in e?j.f(e,n,u(0,r)):e[n]=r}var c={}.toString,l=Array.isArray||function(e){return"Array"==t(e)},h=Math.ceil,p=Math.floor,y=Math.min,e=!n(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),v="object"==typeof window&&window&&window.Math==Math?window:"object"==typeof self&&self&&self.Math==Math?self:Function("return this")(),g=v.document,m=i(g)&&i(g.createElement),_=!e&&!n(function(){return 7!=Object.defineProperty(function(e){return m?g.createElement(e):{}}("div"),"a",{get:function(){return 7}}).a}),k=Object.defineProperty,j={f:e?k:function(e,t,r){if(s(e),t=o(t,!0),s(r),_)try{return k(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},P="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function E(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function O(e,t){return e(t={exports:{}},t.exports),t.exports}function x(t,r){try{T(v,t,r)}catch(e){v[t]=r}return r}function S(e){return"Symbol(".concat(void 0===e?"":e,")_",(++R+H).toString(36))}function M(e){return $[e]||($[e]=G&&V[e]||(G?V:S)("Symbol."+e))}function A(e,t){var r;return l(e)&&("function"!=typeof(r=e.constructor)||r!==Array&&!l(r.prototype)?i(r)&&null===(r=r[q])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===t?0:t)}function C(t){return!n(function(){var e=[];return(e.constructor={})[U]=function(){return{foo:1}},1!==e[t](Boolean).foo})}function D(e){return K(r(e))}function N(e,t){return Q.call(e,t)}var L,I,z,B,T=e?function(e,t,r){return j.f(e,t,u(1,r))}:function(e,t,r){return e[t]=r,e},F=O(function(e){var t="__core-js_shared__",r=v[t]||x(t,{});(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.0.1",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),R=0,H=Math.random(),G=!n(function(){return!String(Symbol())}),$=F("wks"),V=v.Symbol,q=M("species"),U=M("species"),W={}.propertyIsEnumerable,J=Object.getOwnPropertyDescriptor,Y={f:J&&!W.call({1:2},1)?function(e){var t=J(this,e);return!!t&&t.enumerable}:W},Z="".split,K=n(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==t(e)?Z.call(e,""):Object(e)}:Object,Q={}.hasOwnProperty,X=Object.getOwnPropertyDescriptor,ee={f:e?X:function(e,t){if(e=D(e),t=o(t,!0),_)try{return X(e,t)}catch(e){}if(N(e,t))return u(!Y.f.call(e,t),e[t])}},te=F("native-function-to-string",Function.toString),re=v.WeakMap,ne="function"==typeof re&&/native code/.test(te.call(re)),oe=F("keys"),ie={},ae=v.WeakMap;if(ne){var se=new ae,ue=se.get,ce=se.has,le=se.set;L=function(e,t){return le.call(se,e,t),t},I=function(e){return ue.call(se,e)||{}},z=function(e){return ce.call(se,e)}}else{var he=oe[B="state"]||(oe[B]=S(B));ie[he]=!0,L=function(e,t){return T(e,he,t),t},I=function(e){return N(e,he)?e[he]:{}},z=function(e){return N(e,he)}}function fe(e,t){var r=f(e);return r<0?_e(r+t,0):ke(r,t)}function de(s){return function(e,t,r){var n,o=D(e),i=w(o.length),a=fe(r,i);if(s&&t!=t){for(;a<i;)if((n=o[a++])!=n)return!0}else for(;a<i;a++)if((s||a in o)&&o[a]===t)return s||a||0;return!s&&-1}}function pe(e,t){var r,n=D(e),o=0,i=[];for(r in n)!N(ie,r)&&N(n,r)&&i.push(r);for(;t.length>o;)N(n,r=t[o++])&&(~je(i,r)||i.push(r));return i}function ye(e,t){for(var r=Me(t),n=j.f,o=ee.f,i=0;i<r.length;i++){var a=r[i];N(e,a)||n(e,a,o(t,a))}}function ve(e,t){var r=De[Ce(e)];return r==Le||r!=Ne&&("function"==typeof t?n(t):!!t)}function ge(e,t){var r,n,o,i,a,s=e.target,u=e.global,c=e.stat;if(r=u?v:c?v[s]||x(s,{}):(v[s]||{}).prototype)for(n in t){if(i=t[n],o=e.noTargetGet?(a=ze(r,n))&&a.value:r[n],!Ie(u?n:s+(c?".":"#")+n,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;ye(i,o)}(e.sham||o&&o.sham)&&T(i,"sham",!0),we(r,n,i,e)}}function me(e){if(!i(e))return!1;var t=e[Be];return void 0!==t?!!t:l(e)}var be={set:L,get:I,has:z,enforce:function(e){return z(e)?I(e):L(e,{})},getterFor:function(r){return function(e){var t;if(!i(e)||(t=I(e)).type!==r)throw TypeError("Incompatible receiver, "+r+" required");return t}}},we=O(function(e){var t=be.get,s=be.enforce,u=String(te).split("toString");F("inspectSource",function(e){return te.call(e)}),(e.exports=function(e,t,r,n){var o=!!n&&!!n.unsafe,i=!!n&&!!n.enumerable,a=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof t||N(r,"name")||T(r,"name",t),s(r).source=u.join("string"==typeof t?t:"")),e!==v?(o?!a&&e[t]&&(i=!0):delete e[t],i?e[t]=r:T(e,t,r)):i?e[t]=r:x(t,r)})(Function.prototype,"toString",function(){return"function"==typeof this&&t(this).source||te.call(this)})}),_e=Math.max,ke=Math.min,je=de(!1),Pe=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ee=Pe.concat("length","prototype"),Oe={f:Object.getOwnPropertyNames||function(e){return pe(e,Ee)}},xe={f:Object.getOwnPropertySymbols},Se=v.Reflect,Me=Se&&Se.ownKeys||function(e){var t=Oe.f(s(e)),r=xe.f;return r?t.concat(r(e)):t},Ae=/#|\.prototype\./,Ce=ve.normalize=function(e){return String(e).replace(Ae,".").toLowerCase()},De=ve.data={},Ne=ve.NATIVE="N",Le=ve.POLYFILL="P",Ie=ve,ze=ee.f,Be=M("isConcatSpreadable"),Te=9007199254740991,Fe="Maximum allowed index exceeded",Re=!n(function(){var e=[];return e[Be]=!1,e.concat()[0]!==e}),He=C("concat");ge({target:"Array",proto:!0,forced:!Re||!He},{concat:function(e){var t,r,n,o,i,a=b(this),s=A(a,0),u=0;for(t=-1,n=arguments.length;t<n;t++)if(i=-1===t?a:arguments[t],me(i)){if(o=w(i.length),Te<u+o)throw TypeError(Fe);for(r=0;r<o;r++,u++)r in i&&d(s,u,i[r])}else{if(Te<=u)throw TypeError(Fe);d(s,u++,i)}return s.length=u,s}});function Ge(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}function $e(h,e){var f=1==h,d=2==h,p=3==h,y=4==h,v=6==h,g=5==h||v,m=e||A;return function(e,t,r){for(var n,o,i=b(e),a=K(i),s=function(n,o,e){if(Ge(n),void 0===o)return n;switch(e){case 0:return function(){return n.call(o)};case 1:return function(e){return n.call(o,e)};case 2:return function(e,t){return n.call(o,e,t)};case 3:return function(e,t,r){return n.call(o,e,t,r)}}return function(){return n.apply(o,arguments)}}(t,r,3),u=w(a.length),c=0,l=f?m(e,u):d?m(e,0):void 0;c<u;c++)if((g||c in a)&&(o=s(n=a[c],c,i),h))if(f)l[c]=o;else if(o)switch(h){case 3:return!0;case 5:return n;case 6:return c;case 2:l.push(n)}else if(y)return!1;return v?-1:p||y?y:l}}function Ve(e,t){var r=[][e];return!r||!n(function(){r.call(null,t||function(){throw 1},1)})}var qe=$e(4);ge({target:"Array",proto:!0,forced:Ve("every")},{every:function(e){return qe(this,e,arguments[1])}});var Ue=$e(2);ge({target:"Array",proto:!0,forced:!C("filter")},{filter:function(e){return Ue(this,e,arguments[1])}});var We=[].forEach,Je=$e(0),Ye=Ve("forEach")?function(e){return Je(this,e,arguments[1])}:We;ge({target:"Array",proto:!0,forced:[].forEach!=Ye},{forEach:Ye});var Ze=de(!1),Ke=[].indexOf,Qe=!!Ke&&1/[1].indexOf(1,-0)<0,Xe=Ve("indexOf");ge({target:"Array",proto:!0,forced:Qe||Xe},{indexOf:function(e){return Qe?Ke.apply(this,arguments)||0:Ze(this,e,arguments[1])}}),ge({target:"Array",stat:!0},{isArray:l});var et=[].join,tt=K!=Object,rt=Ve("join",",");ge({target:"Array",proto:!0,forced:tt||rt},{join:function(e){return et.call(D(this),void 0===e?",":e)}});var nt=$e(1);ge({target:"Array",proto:!0,forced:!C("map")},{map:function(e){return nt(this,e,arguments[1])}});var ot=Math.max,it=Math.min;ge({target:"Array",proto:!0,forced:!C("splice")},{splice:function(e,t){var r,n,o,i,a,s,u=b(this),c=w(u.length),l=fe(e,c),h=arguments.length;if(0===h?r=n=0:n=1===h?(r=0,c-l):(r=h-2,it(ot(f(t),0),c-l)),9007199254740991<c+r-n)throw TypeError("Maximum allowed length exceeded");for(o=A(u,n),i=0;i<n;i++)(a=l+i)in u&&d(o,i,u[a]);if(r<(o.length=n)){for(i=l;i<c-n;i++)s=i+r,(a=i+n)in u?u[s]=u[a]:delete u[s];for(i=c;c-n+r<i;i--)delete u[i-1]}else if(n<r)for(i=c-n;l<i;i--)s=i+r-1,(a=i+n-1)in u?u[s]=u[a]:delete u[s];for(i=0;i<r;i++)u[i+l]=arguments[i+2];return u.length=c-n+r,o}});var at=[].slice,st={};ge({target:"Function",proto:!0},{bind:Function.bind||function(t){var r=Ge(this),n=at.call(arguments,1),o=function(){var e=n.concat(at.call(arguments));return this instanceof o?function(e,t,r){if(!(t in st)){for(var n=[],o=0;o<t;o++)n[o]="a["+o+"]";st[t]=Function("C,a","return new C("+n.join(",")+")")}return st[t](e,r)}(r,e.length,e):r.apply(t,e)};return i(r.prototype)&&(o.prototype=r.prototype),o}}),ge({target:"Object",stat:!0,forced:!e,sham:!e},{defineProperty:j.f});var ut=ee.f,ct=n(function(){ut(1)});ge({target:"Object",stat:!0,forced:!e||ct,sham:!e},{getOwnPropertyDescriptor:function(e,t){return ut(D(e),t)}});var lt=Object.keys||function(e){return pe(e,Pe)};ge({target:"Object",stat:!0,forced:n(function(){lt(1)})},{keys:function(e){return lt(b(e))}});for(var ht in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var ft=v[ht],dt=ft&&ft.prototype;if(dt&&dt.forEach!==Ye)try{T(dt,"forEach",Ye)}catch(e){dt.forEach=Ye}}var pt=O(function(t,r){(function(){var l={once:"boolean",scope:"object"},h=0;function f(e){return e&&"object"==typeof e&&!Array.isArray(e)&&!(e instanceof Function)&&!(e instanceof RegExp)}function d(e,t,r){var n,o,i,a;for(o in e)t.call(r||null,o,e[o]);if(Object.getOwnPropertySymbols)for(i=0,a=(n=Object.getOwnPropertySymbols(e)).length;i<a;i++)t.call(r||null,n[i],e[n[i]])}function e(){this._enabled=!0,this.unbindAll()}function s(e,t){var r,n,o=[];for(n=0,r=(e=e||[]).length;n<r;n++)e[n].fn!==t&&o.push(e[n]);return o}e.prototype.unbindAll=function(){return this._handlers={},this._handlersAll=[],this._handlersComplex=[],this},e.prototype.on=function(e,r,t){var n,o,i,a,s,u,c;if(f(e))return d(e,function(e,t){this.on(e,t,r)},this),this;for("function"==typeof e&&(t=r,r=e,e=null),n=0,o=(s=[].concat(e)).length;n<o;n++){if(a=s[n],c={order:h++,fn:r},"string"==typeof a||"symbol"==typeof a)this._handlers[a]||(this._handlers[a]=[]),u=this._handlers[a],c.type=a;else if(a instanceof RegExp)u=this._handlersComplex,c.pattern=a;else{if(null!==a)throw Error("Emitter.on: invalid event.");u=this._handlersAll}for(i in t||{})l[i]&&(c[i]=t[i]);u.push(c)}return this},e.prototype.once=function(){var e=Array.prototype.slice.call(arguments),t=e.length-1;return f(e[t])&&1<e.length?e[t]=function(e,t){var r,n={};for(r in e)n[r]=e[r];for(r in t)n[r]=t[r];return n}(e[t],{once:!0}):e.push({once:!0}),this.on.apply(this,e)},e.prototype.off=function(e,t){var r,n,o,i;if(1===arguments.length&&"function"==typeof e){for(o in t=e,this._handlers)this._handlers[o]=s(this._handlers[o],t),0===this._handlers[o].length&&delete this._handlers[o];this._handlersAll=s(this._handlersAll,t),this._handlersComplex=s(this._handlersComplex,t)}else if(1!==arguments.length||"string"!=typeof e&&"symbol"!=typeof e)if(2===arguments.length){var a=[].concat(e);for(r=0,n=a.length;r<n;r++)i=a[r],this._handlers[i]=s(this._handlers[i],t),0===(this._handlers[i]||[]).length&&delete this._handlers[i]}else f(e)&&d(e,this.off,this);else delete this._handlers[e];return this},e.prototype.listeners=function(e){var t,r,n,o=this._handlersAll||[],i=!1;if(!e)throw Error("Emitter.listeners: no event provided.");for(o=o.concat(this._handlers[e]||[]),r=0,n=this._handlersComplex.length;r<n;r++)t=this._handlersComplex[r],~e.search(t.pattern)&&(i=!0,o.push(t));return this._handlersAll.length||i?o.sort(function(e,t){return e.order-t.order}):o.slice(0)},e.prototype.emit=function(e,t){if(!this._enabled)return this;if(f(e))return d(e,this.emit,this),this;var r,n,o,i,a,s,u,c,l=[].concat(e),h=[];for(a=0,u=l.length;a<u;a++){for(s=0,c=(o=this.listeners(l[a])).length;s<c;s++)i=o[s],r={type:l[a],target:this},1<arguments.length&&(r.data=t),i.fn.call("scope"in i?i.scope:this,r),i.once&&h.push(i);for(s=h.length-1;0<=s;s--)(n=h[s].type?this._handlers[h[s].type]:h[s].pattern?this._handlersComplex:this._handlersAll).splice(n.indexOf(h[s]),1)}return this},e.prototype.kill=function(){this.unbindAll(),this._handlers=null,this._handlersAll=null,this._handlersComplex=null,this._enabled=!1,this.unbindAll=this.on=this.once=this.off=this.emit=this.listeners=Function.prototype},e.prototype.disable=function(){return this._enabled=!1,this},e.prototype.enable=function(){return this._enabled=!0,this},e.version="3.1.1",t.exports&&(r=t.exports=e),r.Emitter=e}).call(P)}),yt=(pt.Emitter,O(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r={};function n(t,e){return e.some(function(e){return r[e](t)})}r.array=function(e){return Array.isArray(e)},r.object=function(e){return e&&"object"===(void 0===e?"undefined":a(e))&&!Array.isArray(e)&&!(e instanceof Date)&&!(e instanceof RegExp)&&!("function"==typeof Map&&e instanceof Map)&&!("function"==typeof Set&&e instanceof Set)},r.string=function(e){return"string"==typeof e},r.number=function(e){return"number"==typeof e},r.function=function(e){return"function"==typeof e},r.primitive=function(e){return e!==Object(e)},r.splicer=function(e){return!(!r.array(e)||e.length<1)&&(!(1<e.length&&isNaN(+e[1]))&&n(e[0],["number","function","object"]))};var o=["string","number","function","object"];r.path=function(e){return!(!e&&0!==e&&""!==e)&&[].concat(e).every(function(e){return n(e,o)})},r.dynamicPath=function(e){return e.some(function(e){return r.function(e)||r.object(e)})},r.monkeyPath=function(e,t){var r,n=[],o=e,i=void 0;for(i=0,r=t.length;i<r;i++){if(n.push(t[i]),"object"!==(void 0===o?"undefined":a(o)))return null;if((o=o[t[i]])instanceof mt.Monkey)return n}return null},r.lazyGetter=function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return r&&r.get&&!0===r.get.isLazyGetter},r.monkeyDefinition=function(t){if(r.object(t))return r.function(t.get)&&(!t.cursors||r.object(t.cursors)&&Object.keys(t.cursors).every(function(e){return r.path(t.cursors[e])}))?"object":null;if(r.array(t)){var e=1;return r.object(t[t.length-1])&&e++,r.function(t[t.length-e])&&t.slice(0,-e).every(function(e){return r.path(e)})?"array":null}return null},r.watcherMapping=function(t){return r.object(t)&&Object.keys(t).every(function(e){return r.path(t[e])})};var i=["set","apply","push","unshift","concat","pop","shift","deepMerge","merge","splice","unset"];r.operationType=function(e){return"string"==typeof e&&!!~i.indexOf(e)},t.default=r}));E(yt);var vt=O(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.uniqid=t.deepMerge=t.shallowMerge=t.deepFreeze=t.freeze=t.deepClone=t.shallowClone=t.Archive=void 0;var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e};function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}t.arrayFrom=function(e){return d(e)},t.before=function(e,t){return function(){e.apply(null,arguments),t.apply(null,arguments)}},t.coercePath=function(e){return e||0===e||""===e?e:[]},t.getIn=function(e,t){if(!t)return m;var r=[],n=!0,o=e,i=void 0,a=void 0,s=void 0;for(a=0,s=t.length;a<s;a++){if(!o)return{data:void 0,solvedPath:r.concat(t.slice(a)),exists:!1};if("function"==typeof t[a]){if(!f.default.array(o))return m;if(!~(i=u(o,t[a])))return m;r.push(i),o=o[i]}else if("object"===h(t[a])){if(!f.default.array(o))return m;if(!~(i=u(o,function(e){return l(e,t[a])})))return m;r.push(i),o=o[i]}else r.push(t[a]),n="object"===(void 0===o?"undefined":h(o))&&t[a]in o,o=o[t[a]]}return{data:o,solvedPath:r,exists:n}},t.makeError=function(e,t){var r=new Error(e);for(var n in t)r[n]=t[n];return r},t.hashPath=function(e){return"λ"+e.map(function(e){return f.default.function(e)||f.default.object(e)?"#"+j()+"#":e}).join("λ")},t.solveRelativePath=function(e,t){var r=[];t=[].concat(t);for(var n=0,o=t.length;n<o;n++){var i=t[n];"."===i?n||(r=e.slice(0)):".."===i?r=(n?r:e).slice(0,-1):r.push(i)}return r},t.solveUpdate=function(e,t){var r=void 0,n=void 0,o=void 0,i=void 0,a=void 0,s=void 0,u=void 0,c=void 0;for(r=0,i=e.length;r<i;r++){if(!(u=e[r]).length)return!0;for(n=0,a=t.length;n<a;n++){if(!(c=t[n])||!c.length)return!0;for(o=0,s=c.length;o<s&&c[o]==u[o];o++)if(o+1===s||o+1===u.length)return!0}}return!1},t.splice=function(e,t,r){for(var n=arguments.length,o=Array(3<n?n-3:0),i=3;i<n;i++)o[i-3]=arguments[i];if(void 0===r&&2===arguments.length)r=e.length-t;else if(null==r)r=0;else if(isNaN(+r))throw new Error("argument nb "+r+" can not be parsed into a number!");r=Math.max(0,r),f.default.function(t)&&(t=u(e,t));f.default.object(t)&&(t=u(e,function(e){return l(e,t)}));return 0<=t?e.slice(0,t).concat(o).concat(e.slice(t+r)):e.slice(0,e.length+t).concat(o).concat(e.slice(e.length+t+r))};var o,f=(o=yt)&&o.__esModule?o:{default:o};var a={}.hasOwnProperty;function u(e,t){var r,n=void 0;for(n=0,r=e.length;n<r;n++)if(t(e[n]))return n;return-1}function d(e){var t,r=new Array(e.length),n=void 0;for(n=0,t=e.length;n<t;n++)r[n]=e[n];return r}t.Archive=(r(i,[{key:"get",value:function(){return this.records}},{key:"add",value:function(e){return this.records.unshift(e),this.records.length>this.size&&(this.records.length=this.size),this}},{key:"clear",value:function(){return this.records=[],this}},{key:"back",value:function(e){var t=this.records[e-1];return t&&(this.records=this.records.slice(e)),t}}]),i);function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.size=e,this.records=[]}function p(e,t){if(!t||"object"!==(void 0===t?"undefined":h(t))||t instanceof Error||t instanceof mt.MonkeyDefinition||t instanceof mt.Monkey||"ArrayBuffer"in P&&t instanceof ArrayBuffer)return t;if(f.default.array(t)){if(e){for(var r=new Array(t.length),n=0,o=t.length;n<o;n++)r[n]=p(!0,t[n]);return r}return d(t)}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return function(e){var t=e.source,r="";return e.global&&(r+="g"),e.multiline&&(r+="m"),e.ignoreCase&&(r+="i"),e.sticky&&(r+="y"),e.unicode&&(r+="u"),new RegExp(t,r)}(t);if(f.default.object(t)){for(var i={},a=Object.getOwnPropertyNames(t),s=0,u=a.length;s<u;s++){var c=a[s],l=Object.getOwnPropertyDescriptor(t,c);!0===l.enumerable?l.get&&l.get.isLazyGetter?Object.defineProperty(i,c,{get:l.get,enumerable:!0,configurable:!0}):i[c]=e?p(!0,t[c]):t[c]:!1===l.enumerable&&Object.defineProperty(i,c,{value:e?p(!0,l.value):l.value,enumerable:!1,writable:!0,configurable:!0})}return i}return t}var s=p.bind(null,!1),c=p.bind(null,!0);function l(e,t){var r=!0,n=void 0;if(!e)return!1;for(n in t)if(f.default.object(t[n]))r=r&&l(e[n],t[n]);else if(f.default.array(t[n]))r=r&&!!~t[n].indexOf(e[n]);else if(e[n]!==t[n])return!1;return r}function y(e,t){if(!("object"!==(void 0===t?"undefined":h(t))||null===t||t instanceof mt.Monkey)&&(Object.freeze(t),e))if(Array.isArray(t)){var r,n=void 0;for(n=0,r=t.length;n<r;n++)g(t[n])}else{var o=void 0,i=void 0;for(i in t)f.default.lazyGetter(t,i)||(o=t[i])&&a.call(t,i)&&"object"===(void 0===o?"undefined":h(o))&&!Object.isFrozen(o)&&g(o)}}t.shallowClone=s,t.deepClone=c;var v=y.bind(null,!1),g=y.bind(null,!0);t.freeze=v,t.deepFreeze=g;var m={data:void 0,solvedPath:null,exists:!1};function b(e){for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o,i=r[0],a=void 0,s=void 0,u=void 0;for(s=1,o=r.length;s<o;s++)for(u in a=r[s])!e||!f.default.object(a[u])||a[u]instanceof mt.Monkey?i[u]=a[u]:i[u]=b(!0,i[u]||{},a[u]);return i}var w=b.bind(null,!1),_=b.bind(null,!0);t.shallowMerge=w,t.deepMerge=_;var k,j=(k=0,function(){return k++});t.uniqid=j});E(vt);vt.uniqid,vt.deepMerge,vt.shallowMerge,vt.deepFreeze,vt.freeze,vt.deepClone,vt.shallowClone,vt.Archive,vt.arrayFrom,vt.before,vt.coercePath,vt.getIn,vt.makeError,vt.hashPath,vt.solveRelativePath,vt.solveUpdate,vt.splice;var gt=O(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},o=r.type,i=r.value,a=r.options,s=void 0===a?{}:a,u={root:e},c=["root"].concat(function(e){{if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}}(t)),l=[],h=u,f=void 0,d=void 0,p=void 0;for(f=0,d=c.length;f<d;f++){if(p=c[f],0<f&&l.push(p),f===d-1){if("set"===o){if(n.pure&&h[p]===i)return{node:h[p]};v.default.lazyGetter(h,p)?Object.defineProperty(h,p,{value:i,enumerable:!0,configurable:!0}):n.persistent&&!s.mutableLeaf?h[p]=(0,vt.shallowClone)(i):h[p]=i}else if("monkey"===o)Object.defineProperty(h,p,{get:i,enumerable:!0,configurable:!0});else if("apply"===o){var y=i(h[p]);if(n.pure&&h[p]===y)return{node:h[p]};v.default.lazyGetter(h,p)?Object.defineProperty(h,p,{value:y,enumerable:!0,configurable:!0}):n.persistent?h[p]=(0,vt.shallowClone)(y):h[p]=y}else if("push"===o){if(!v.default.array(h[p]))throw g("push","array",l);n.persistent?h[p]=h[p].concat([i]):h[p].push(i)}else if("unshift"===o){if(!v.default.array(h[p]))throw g("unshift","array",l);n.persistent?h[p]=[i].concat(h[p]):h[p].unshift(i)}else if("concat"===o){if(!v.default.array(h[p]))throw g("concat","array",l);n.persistent?h[p]=h[p].concat(i):h[p].push.apply(h[p],i)}else if("splice"===o){if(!v.default.array(h[p]))throw g("splice","array",l);n.persistent?h[p]=vt.splice.apply(null,[h[p]].concat(i)):h[p].splice.apply(h[p],i)}else if("pop"===o){if(!v.default.array(h[p]))throw g("pop","array",l);n.persistent?h[p]=(0,vt.splice)(h[p],-1,1):h[p].pop()}else if("shift"===o){if(!v.default.array(h[p]))throw g("shift","array",l);n.persistent?h[p]=(0,vt.splice)(h[p],0,1):h[p].shift()}else if("unset"===o)v.default.object(h)?delete h[p]:v.default.array(h)&&h.splice(p,1);else if("merge"===o){if(!v.default.object(h[p]))throw g("merge","object",l);n.persistent?h[p]=(0,vt.shallowMerge)({},h[p],i):h[p]=(0,vt.shallowMerge)(h[p],i)}else if("deepMerge"===o){if(!v.default.object(h[p]))throw g("deepMerge","object",l);n.persistent?h[p]=(0,vt.deepMerge)({},h[p],i):h[p]=(0,vt.deepMerge)(h[p],i)}n.immutable&&!s.mutableLeaf&&(0,vt.deepFreeze)(h);break}v.default.primitive(h[p])?h[p]={}:n.persistent&&(h[p]=(0,vt.shallowClone)(h[p])),n.immutable&&0<d&&(0,vt.freeze)(h),h=h[p]}return v.default.lazyGetter(h,p)?{data:u.root}:{data:u.root,node:h[p]}};var r,v=(r=yt)&&r.__esModule?r:{default:r};function g(e,t,r){return(0,vt.makeError)('Baobab.update: cannot apply the "'+e+'" on a non '+t+" (path: /"+r.join("/")+").",{path:r})}});E(gt);var mt=O(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Monkey=t.MonkeyDefinition=void 0;var r=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e};function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=o(yt),c=o(gt);function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.MonkeyDefinition=function e(t){var r=this;s(this,e);var n=a.default.monkeyDefinition(t);if(!n)throw(0,vt.makeError)("Baobab.monkey: invalid definition.",{definition:t});if(this.type=n,"object"===this.type)this.getter=t.get,this.projection=t.cursors||{},this.paths=Object.keys(this.projection).map(function(e){return r.projection[e]}),this.options=t.options||{};else{var o=1,i={};a.default.object(t[t.length-1])&&(o++,i=t[t.length-1]),this.getter=t[t.length-o],this.projection=t.slice(0,-o),this.paths=this.projection,this.options=i}this.paths=this.paths.map(function(e){return[].concat(e)}),this.hasDynamicPaths=this.paths.some(a.default.dynamicPath)},t.Monkey=(r(u,[{key:"relatedPaths",value:function(){var o=this,e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=void 0;return t=this.definition.hasDynamicPaths?this.depPaths.map(function(e){return(0,vt.getIn)(o.tree._data,e).solvedPath}):this.depPaths,e&&this.depPaths.some(function(e){return!!a.default.monkeyPath(o.tree._monkeys,e)})?t.reduce(function(e,t){var r=a.default.monkeyPath(o.tree._monkeys,t);if(!r)return e.concat([t]);var n=(0,vt.getIn)(o.tree._monkeys,r).data;return e.concat(n.relatedPaths())},[]):t}},{key:"update",value:function(){var t,r,n,o,i,a=this,e=this.tree.project(this.projection),s=(t=this.tree,r=this.definition,n=e,o=null,i=!1,function(){if(!i){o=r.getter.apply(t,"object"===r.type?[n]:n),t.options.immutable&&!1!==r.options.immutable&&(0,vt.deepFreeze)(o);var e=(0,vt.hashPath)(a.path);t._affectedPathsIndex[e]=!0,i=!0}return o});if(s.isLazyGetter=!0,this.tree.options.lazyMonkeys)this.tree._data=(0,c.default)(this.tree._data,this.path,{type:"monkey",value:s},this.tree.options).data;else{var u=(0,c.default)(this.tree._data,this.path,{type:"set",value:s(),options:{mutableLeaf:!this.definition.options.immutable}},this.tree.options);"data"in u&&(this.tree._data=u.data)}return this.tree.emit("_monkey",{monkey:this,path:this.path}),this}},{key:"release",value:function(){this.tree.off("write",this.writeListener),this.tree.off("_monkey",this.recursiveListener),this.state.killed=!0,delete this.projection,delete this.depPaths,delete this.tree}}]),u);function u(e,t,r){var o=this;s(this,u),this.tree=e,this.path=t;var n=(this.definition=r).projection,i=vt.solveRelativePath.bind(null,t.slice(0,-1));"object"===r.type?(this.projection=Object.keys(n).reduce(function(e,t){return e[t]=i(n[t]),e},{}),this.depPaths=Object.keys(this.projection).map(function(e){return o.projection[e]})):(this.projection=n.map(i),this.depPaths=this.projection),this.state={killed:!1},this.writeListener=function(e){var t=e.data.path;o.state.killed||(0,vt.solveUpdate)([t],o.relatedPaths())&&o.update()},this.recursiveListener=function(e){var t=e.data,r=t.monkey,n=t.path;o.state.killed||o!==r&&(0,vt.solveUpdate)([n],o.relatedPaths(!1))&&o.update()},this.tree.on("write",this.writeListener),this.tree.on("_monkey",this.recursiveListener),this.update()}});E(mt);mt.Monkey,mt.MonkeyDefinition;var bt=O(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e};function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=i(pt),s=i(yt);function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!t)throw(0,vt.makeError)("Baobab.Cursor."+e+": cannot use "+e+" on an unresolved dynamic path.",{path:t})}var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,o.default),r(c,[{key:"_getComparedPaths",value:function(){var e=this._monkeyPath?(0,vt.getIn)(this.tree._monkeys,this._monkeyPath).data.relatedPaths():[];return[this.solvedPath].concat(e)}},{key:"isRoot",value:function(){return!this.path.length}},{key:"isLeaf",value:function(){return s.default.primitive(this._get().data)}},{key:"isBranch",value:function(){return!this.isRoot()&&!this.isLeaf()}},{key:"root",value:function(){return this.tree.select()}},{key:"select",value:function(e){return 1<arguments.length&&(e=(0,vt.arrayFrom)(arguments)),this.tree.select(this.path.concat(e))}},{key:"up",value:function(){return this.isRoot()?null:this.tree.select(this.path.slice(0,-1))}},{key:"down",value:function(){if(a("down",this.solvedPath),!(this._get().data instanceof Array))throw Error("Baobab.Cursor.down: cannot go down on a non-list type.");return this.tree.select(this.solvedPath.concat(0))}},{key:"left",value:function(){a("left",this.solvedPath);var e=+this.solvedPath[this.solvedPath.length-1];if(isNaN(e))throw Error("Baobab.Cursor.left: cannot go left on a non-list type.");return e?this.tree.select(this.solvedPath.slice(0,-1).concat(e-1)):null}},{key:"right",value:function(){a("right",this.solvedPath);var e=+this.solvedPath[this.solvedPath.length-1];if(isNaN(e))throw Error("Baobab.Cursor.right: cannot go right on a non-list type.");return 1+e===this.up()._get().data.length?null:this.tree.select(this.solvedPath.slice(0,-1).concat(1+e))}},{key:"leftmost",value:function(){a("leftmost",this.solvedPath);var e=+this.solvedPath[this.solvedPath.length-1];if(isNaN(e))throw Error("Baobab.Cursor.leftmost: cannot go left on a non-list type.");return this.tree.select(this.solvedPath.slice(0,-1).concat(0))}},{key:"rightmost",value:function(){a("rightmost",this.solvedPath);var e=+this.solvedPath[this.solvedPath.length-1];if(isNaN(e))throw Error("Baobab.Cursor.rightmost: cannot go right on a non-list type.");var t=this.up()._get().data;return this.tree.select(this.solvedPath.slice(0,-1).concat(t.length-1))}},{key:"map",value:function(r,n){a("map",this.solvedPath);var o=this._get().data,i=arguments.length;if(!s.default.array(o))throw Error("baobab.Cursor.map: cannot map a non-list type.");return o.map(function(e,t){return r.call(1<i?n:this,this.select(t),t,o)},this)}},{key:"_get",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];if(!s.default.path(e))throw(0,vt.makeError)("Baobab.Cursor.getters: invalid path.",{path:e});return this.solvedPath?(0,vt.getIn)(this.tree._data,this.solvedPath.concat(e)):{data:void 0,solvedPath:null,exists:!1}}},{key:"exists",value:function(e){return e=(0,vt.coercePath)(e),1<arguments.length&&(e=(0,vt.arrayFrom)(arguments)),this._get(e).exists}},{key:"get",value:function(e){e=(0,vt.coercePath)(e),1<arguments.length&&(e=(0,vt.arrayFrom)(arguments));var t=this._get(e),r=t.data,n=t.solvedPath;return this.tree.emit("get",{data:r,solvedPath:n,path:this.path.concat(e)}),r}},{key:"clone",value:function(){var e=this.get.apply(this,arguments);return(0,vt.shallowClone)(e)}},{key:"deepClone",value:function(){var e=this.get.apply(this,arguments);return(0,vt.deepClone)(e)}},{key:"serialize",value:function(e){if(e=(0,vt.coercePath)(e),1<arguments.length&&(e=(0,vt.arrayFrom)(arguments)),!s.default.path(e))throw(0,vt.makeError)("Baobab.Cursor.getters: invalid path.",{path:e});if(this.solvedPath){var t=this.solvedPath.concat(e),r=(0,vt.deepClone)((0,vt.getIn)(this.tree._data,t).data);return function e(t,r){if(s.default.object(r)&&s.default.object(t))for(var n in r)r[n]instanceof mt.Monkey?delete t[n]:e(t[n],r[n])}(r,(0,vt.getIn)(this.tree._monkeys,t).data),r}}},{key:"project",value:function(e){if(s.default.object(e)){var t={};for(var r in e)t[r]=this.get(e[r]);return t}if(s.default.array(e)){for(var n=[],o=0,i=e.length;o<i;o++)n.push(this.get(e[o]));return n}throw(0,vt.makeError)("Baobab.Cursor.project: wrong projection.",{projection:e})}},{key:"startRecording",value:function(e){if((e=e||1/0)<1)throw(0,vt.makeError)("Baobab.Cursor.startRecording: invalid max records.",{value:e});return this.state.recording=!0,this.archive||(this._lazyBind(),this.archive=new vt.Archive(e)),this}},{key:"stopRecording",value:function(){return this.state.recording=!1,this}},{key:"undo",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;if(!this.state.recording)throw new Error("Baobab.Cursor.undo: cursor is not recording.");var t=this.archive.back(e);if(!t)throw Error("Baobab.Cursor.undo: cannot find a relevant record.");return this.state.undoing=!0,this.set(t),this}},{key:"hasHistory",value:function(){return!(!this.archive||!this.archive.get().length)}},{key:"getHistory",value:function(){return this.archive?this.archive.get():[]}},{key:"clearHistory",value:function(){return this.archive&&this.archive.clear(),this}},{key:"release",value:function(){this._dynamicPath&&this.tree.off("write",this._writeHandler),this.tree.off("update",this._updateHandler),this.hash&&delete this.tree._cursors[this.hash],delete this.tree,delete this.path,delete this.solvedPath,delete this.archive,this.kill(),this.state.killed=!0}},{key:"toJSON",value:function(){return this.serialize()}},{key:"toString",value:function(){return this._identity}}]),c);function c(e,t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));t=t||[],a._identity="[object Cursor]",a._archive=null,a.tree=e,a.path=t,a.hash=r,a.state={killed:!1,recording:!1,undoing:!1},a._dynamicPath=s.default.dynamicPath(a.path),a._monkeyPath=s.default.monkeyPath(a.tree._monkeys,a.path),a._dynamicPath?a.solvedPath=(0,vt.getIn)(a.tree._data,a.path).solvedPath:a.solvedPath=a.path,a._writeHandler=function(e){var t=e.data;!a.state.killed&&(0,vt.solveUpdate)([t.path],a._getComparedPaths())&&(a.solvedPath=(0,vt.getIn)(a.tree._data,a.path).solvedPath)};var n=!(a._updateHandler=function(e){if(!a.state.killed){var t=e.data,r=t.paths,n=t.previousData,o=function(e){var t=a,r={get previousData(){return(0,vt.getIn)(e,t.solvedPath).data},get currentData(){return t.get()}};return a.state.recording&&!a.state.undoing&&a.archive.add(r.previousData),a.state.undoing=!1,a.emit("update",r)}.bind(a,n),i=a._getComparedPaths();return(0,vt.solveUpdate)(r,i)?o():void 0}});return a._lazyBind=function(){if(!n)return n=!0,a._dynamicPath&&a.tree.on("write",a._writeHandler),a.tree.on("update",a._updateHandler)},a._dynamicPath?a._lazyBind():(a.on=(0,vt.before)(a._lazyBind,a.on.bind(a)),a.once=(0,vt.before)(a._lazyBind,a.once.bind(a))),a}t.default=u,"function"==typeof Symbol&&void 0!==Symbol.iterator&&(u.prototype[Symbol.iterator]=function(){var e=this._get().data;if(!s.default.array(e))throw Error("baobab.Cursor.@@iterate: cannot iterate a non-list type.");var t=0,r=this,n=e.length;return{next:function(){return t<n?{value:r.select(t++)}:{done:!0}}}});var l={unset:!0,pop:!0,shift:!0};function h(n,o){u.prototype[n]=function(e,t){if(2<arguments.length)throw(0,vt.makeError)("Baobab.Cursor."+n+": too many arguments.");if(1!==arguments.length||l[n]||(t=e,e=[]),e=(0,vt.coercePath)(e),!s.default.path(e))throw(0,vt.makeError)("Baobab.Cursor."+n+": invalid path.",{path:e});if(o&&!o(t))throw(0,vt.makeError)("Baobab.Cursor."+n+": invalid value.",{path:e,value:t});if(!this.solvedPath)throw(0,vt.makeError)("Baobab.Cursor."+n+": the dynamic path of the cursor cannot be solved.",{path:this.path});var r=this.solvedPath.concat(e);return this.tree.update(r,{type:n,value:t})}}h("set"),h("unset"),h("apply",s.default.function),h("push"),h("concat",s.default.array),h("unshift"),h("pop"),h("shift"),h("splice",s.default.splicer),h("merge",s.default.object),h("deepMerge",s.default.object)});E(bt);var wt=O(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e};function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=s(pt),i=s(bt),a=s(yt);function s(e){return e&&e.__esModule?e:{default:e}}var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,o.default),r(c,[{key:"getWatchedPaths",value:function(){var n=this;return Object.keys(this.mapping).map(function(e){var t=n.mapping[e];return t instanceof i.default?t.solvedPath:n.mapping[e]}).reduce(function(e,t){if(t=[].concat(t),a.default.dynamicPath(t)&&(t=(0,vt.getIn)(n.tree._data,t).solvedPath),!t)return e;var r=a.default.monkeyPath(n.tree._monkeys,t);return r?e.concat((0,vt.getIn)(n.tree._monkeys,r).data.relatedPaths()):e.concat([t])},[])}},{key:"getCursors",value:function(){var r=this,n={};return Object.keys(this.mapping).forEach(function(e){var t=r.mapping[e];t instanceof i.default?n[e]=t:n[e]=r.tree.select(t)}),n}},{key:"refresh",value:function(e){if(!a.default.watcherMapping(e))throw(0,vt.makeError)("Baobab.watch: invalid mapping.",{mapping:e});this.mapping=e;var t={};for(var r in e)t[r]=e[r]instanceof i.default?e[r].path:e[r];this.get=this.tree.project.bind(this.tree,t)}},{key:"release",value:function(){this.tree.off("update",this.handler),this.state.killed=!0,this.kill()}}]),c);function c(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return r.tree=e,r.mapping=null,r.state={killed:!1},r.refresh(t),r.handler=function(e){if(!r.state.killed){var t=r.getWatchedPaths();return(0,vt.solveUpdate)(e.data.paths,t)?r.emit("update"):void 0}},r.tree.on("update",r.handler),r}t.default=u});E(wt);function _t(e,t){t=t||{};var r=typeof e;if("string"==r&&0<e.length)return function(e){if(100<(e=String(e)).length)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"days":case"day":case"d":return r*Pt;case"hours":case"hour":case"hrs":case"hr":case"h":return r*jt;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"==r&&!1===isNaN(e))return t.long?function(e){return Et(e,Pt,"day")||Et(e,jt,"hour")||Et(e,6e4,"minute")||Et(e,1e3,"second")||e+" ms"}(e):function(e){if(Pt<=e)return Math.round(e/Pt)+"d";if(jt<=e)return Math.round(e/jt)+"h";if(6e4<=e)return Math.round(e/6e4)+"m";if(1e3<=e)return Math.round(e/1e3)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}var kt=E(O(function(e){var t=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e};function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=s(pt),o=s(bt),i=s(wt),y=s(yt),v=s(gt),a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(vt);function s(e){return e&&e.__esModule?e:{default:e}}var u=a.arrayFrom,g=a.coercePath,c=a.deepFreeze,m=a.getIn,b=a.makeError,w=a.deepClone,_=a.deepMerge,k=a.shallowClone,j=a.shallowMerge,P=a.hashPath,l={autoCommit:!0,asynchronous:!0,immutable:!0,lazyMonkeys:!0,monkeyBusiness:!0,persistent:!0,pure:!0,validate:null,validationBehavior:"rollback"},h=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(f,r.default),t(f,[{key:"_refreshMonkeys",value:function(e,t,r){function o(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(e instanceof mt.MonkeyDefinition||e instanceof mt.Monkey){var r=new mt.Monkey(i,t,e instanceof mt.Monkey?e.definition:e);(0,v.default)(i._monkeys,t,{type:"set",value:r},{immutable:!1,persistent:!1,pure:!1})}else if(y.default.object(e))for(var n in e)o(e[n],t.concat(n))}var i=this;if(arguments.length){var n=m(this._monkeys,t).data;n&&!function e(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(t instanceof mt.Monkey)return t.release(),void(0,v.default)(i._monkeys,r,{type:"unset"},{immutable:!1,persistent:!1,pure:!1});if(y.default.object(t))for(var n in t)e(t[n],r.concat(n))}(n,t),"unset"!==r&&o(e,t)}else o(this._data);return this}},{key:"validate",value:function(e){var t=this.options,r=t.validate,n=t.validationBehavior;if("function"!=typeof r)return null;var o=r.call(this,this._previousData,this._data,e||[[]]);return o instanceof Error?("rollback"===n&&(this._data=this._previousData,this._affectedPathsIndex={},this._transaction=[],this._previousData=this._data),this.emit("invalid",{error:o}),o):null}},{key:"select",value:function(e){if(e=e||[],1<arguments.length&&(e=u(arguments)),!y.default.path(e))throw b("Baobab.select: invalid path.",{path:e});e=[].concat(e);var t=P(e),r=this._cursors[t];return r||(r=new o.default(this,e,t),this._cursors[t]=r),this.emit("select",{path:e,cursor:r}),r}},{key:"update",value:function(e,t){var r=this;if(e=g(e),!y.default.operationType(t.type))throw b('Baobab.update: unknown operation type "'+t.type+'".',{operation:t});var n=m(this._data,e),o=n.solvedPath,i=n.exists;if(!o)throw b("Baobab.update: could not solve the given path.",{path:o});var a=y.default.monkeyPath(this._monkeys,o);if(a&&o.length>a.length)throw b("Baobab.update: attempting to update a read-only path.",{path:o});if("unset"!==t.type||i){var s=t;if(/merge/i.test(t.type)){var u=m(this._monkeys,o).data;if(y.default.object(u)){s=k(s);var c=m(this._data,o).data;/deep/i.test(s.type)?s.value=_({},_({},c,w(u)),s.value):s.value=j({},_({},c,w(u)),s.value)}}this._transaction.length||(this._previousData=this._data);var l=(0,v.default)(this._data,o,s,this.options),h=l.data,f=l.node;if(!("data"in l))return f;var d=o.concat("push"===t.type?f.length-1:[]),p=P(d);return this._data=h,this._affectedPathsIndex[p]=!0,this._transaction.push(j({},t,{path:d})),this.options.monkeyBusiness&&this._refreshMonkeys(f,o,t.type),this.emit("write",{path:d}),this.options.autoCommit&&(this.options.asynchronous?this._future||(this._future=setTimeout(function(){return r.commit()},0)):this.commit()),f}}},{key:"commit",value:function(){if(!this._transaction.length)return this;this._future&&(this._future=clearTimeout(this._future));var e=Object.keys(this._affectedPathsIndex).map(function(e){return"λ"!==e?e.split("λ").slice(1):[]});if(this.validate(e))return this;var t=this._transaction,r=this._previousData;return this._affectedPathsIndex={},this._transaction=[],this._previousData=this._data,this.emit("update",{paths:e,currentData:this._data,transaction:t,previousData:r}),this}},{key:"getMonkey",value:function(e){e=g(e);var t=m(this._monkeys,[].concat(e)).data;return t instanceof mt.Monkey?t:null}},{key:"watch",value:function(e){return new i.default(this,e)}},{key:"release",value:function(){var e=void 0;for(e in this.emit("release"),delete this.root,delete this._data,delete this._previousData,delete this._transaction,delete this._affectedPathsIndex,delete this._monkeys,this._cursors)this._cursors[e].release();delete this._cursors,this.kill()}},{key:"toJSON",value:function(){return this.serialize()}},{key:"toString",value:function(){return this._identity}}]),f);function f(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));if(arguments.length<1&&(e={}),!y.default.object(e)&&!y.default.array(e))throw b("Baobab: invalid data.",{data:e});r.options=j({},l,t),r.options.persistent||(r.options.immutable=!1,r.options.pure=!1),r._identity="[object Baobab]",r._cursors={},r._future=null,r._transaction=[],r._affectedPathsIndex={},r._monkeys={},r._previousData=null,r._data=e,r.root=new o.default(r,[],"λ"),delete r.root.release,r.options.immutable&&c(r._data);["apply","clone","concat","deepClone","deepMerge","exists","get","push","merge","pop","project","serialize","set","shift","splice","unset","unshift"].forEach(function(t){r[t]=function(){var e=this.root[t].apply(this.root,arguments);return e instanceof o.default?this:e}}),r.options.monkeyBusiness&&r._refreshMonkeys();var n=r.validate();if(n)throw Error("Baobab: invalid data.",{error:n});return r}h.monkey=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(!t.length)throw new Error("Baobab.monkey: missing definition.");return 1===t.length&&"function"!=typeof t[0]?new mt.MonkeyDefinition(t[0]):new mt.MonkeyDefinition(t)},h.dynamicNode=h.monkey,h.Cursor=o.default,h.MonkeyDefinition=mt.MonkeyDefinition,h.Monkey=mt.Monkey,h.type=y.default,h.helpers=a,h.VERSION="2.5.2",e.exports=h})),jt=36e5,Pt=864e5;function Et(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var Ot=O(function(e,s){var u;function t(e){function n(){if(n.enabled){var o=n,e=+new Date,t=e-(u||e);o.diff=t,o.prev=u,o.curr=e,u=e;for(var i=new Array(arguments.length),r=0;r<i.length;r++)i[r]=arguments[r];i[0]=s.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var a=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(e,t){if("%%"===e)return e;a++;var r=s.formatters[t];if("function"==typeof r){var n=i[a];e=r.call(o,n),i.splice(a,1),a--}return e}),s.formatArgs.call(o,i),(n.log||s.log||console.log.bind(console)).apply(o,i)}}return n.namespace=e,n.enabled=s.enabled(e),n.useColors=s.useColors(),n.color=function(e){var t,r=0;for(t in e)r=(r<<5)-r+e.charCodeAt(t),r|=0;return s.colors[Math.abs(r)%s.colors.length]}(e),"function"==typeof s.init&&s.init(n),n}(s=e.exports=t.debug=t.default=t).coerce=function(e){return e instanceof Error?e.stack||e.message:e},s.disable=function(){s.enable("")},s.enable=function(e){s.save(e),s.names=[],s.skips=[];for(var t=("string"==typeof e?e:"").split(/[\s,]+/),r=t.length,n=0;n<r;n++)t[n]&&("-"===(e=t[n].replace(/\*/g,".*?"))[0]?s.skips.push(new RegExp("^"+e.substr(1)+"$")):s.names.push(new RegExp("^"+e+"$")))},s.enabled=function(e){var t,r;for(t=0,r=s.skips.length;t<r;t++)if(s.skips[t].test(e))return!1;for(t=0,r=s.names.length;t<r;t++)if(s.names[t].test(e))return!0;return!1},s.humanize=_t,s.names=[],s.skips=[],s.formatters={}}),xt=(Ot.coerce,Ot.disable,Ot.enable,Ot.enabled,Ot.humanize,Ot.names,Ot.skips,Ot.formatters,O(function(e,i){function t(){var e;try{e=i.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(i=e.exports=Ot).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},i.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+i.humanize(this.diff),!t)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var n=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(n++,"%c"===e&&(o=n))}),e.splice(o,0,r)},i.save=function(e){try{null==e?i.storage.removeItem("debug"):i.storage.debug=e}catch(e){}},i.load=t,i.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},i.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),i.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],i.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},i.enable(t())})),St=(xt.log,xt.formatArgs,xt.save,xt.load,xt.useColors,xt.storage,xt.colors,xt("Dispatchr:Action"));function Mt(e,t){this.name=e,this.payload=t,this._handlers=null,this._isExecuting=!1,this._isCompleted=null}Mt.prototype.getStoreName=function(e){return"string"==typeof e?e:e.storeName},Mt.prototype.execute=function(e){if(this._isExecuting)throw new Error("Action is already dispatched");var t=this;this._handlers=e,this._isExecuting=!0,this._isCompleted={},Object.keys(e).forEach(function(e){t._callHandler(e)})},Mt.prototype._callHandler=function(e){var t=this,r=t._handlers[e];if(!r)throw new Error(e+" does not have a handler for action "+t.name);t._isCompleted[e]||(t._isCompleted[e]=!1,St("executing handler for "+e),r(t.payload,t.name),t._isCompleted[e]=!0)},Mt.prototype.waitFor=function(e,t){var r=this;if(!r._isExecuting)throw new Error("waitFor called even though there is no action being executed!");Array.isArray(e)||(e=[e]),St("waiting on "+e.join(", ")),e.forEach(function(e){e=r.getStoreName(e),r._handlers[e]&&r._callHandler(e)}),t()};var At=Mt,Ct=xt("Dispatchr:DispatcherContext");function Dt(e,t){this.dispatcher=e,this.storeInstances={},this.currentAction=null,this.dispatcherInterface={getContext:function(){return t},getStore:this.getStore.bind(this),waitFor:this.waitFor.bind(this)}}Dt.prototype.getStore=function(e){var t=this.dispatcher.getStoreName(e);if(!this.storeInstances[t]){if(!this.dispatcher.stores[t])throw new Error("Store "+t+" was not registered.");this.storeInstances[t]=new this.dispatcher.stores[t](this.dispatcherInterface)}return this.storeInstances[t]},Dt.prototype.dispatch=function(e,t){if(!e)throw new Error("actionName parameter `"+e+"` is invalid.");if(this.currentAction)throw new Error("Cannot call dispatch while another dispatch is executing. Attempted to execute '"+e+"' but '"+this.currentAction.name+"' is already executing.");var r=this.dispatcher.handlers[e]||[],n=this.dispatcher.handlers.default||[];if(r.length||n.length){Ct("dispatching "+e,t),this.currentAction=new At(e,t);var o=this,i=r.concat(n),a={};try{i.forEach(function(e){if(!a[e.name]){var t=o.getStore(e.name);if("function"==typeof e.handler)a[e.name]=e.handler.bind(t);else{if(!t[e.handler])throw new Error(e.name+" does not have a method called "+e.handler);a[e.name]=t[e.handler].bind(t)}}}),this.currentAction.execute(a)}catch(e){throw e}finally{Ct("finished "+e),this.currentAction=null}}else Ct(e+" does not have any registered handlers")},Dt.prototype.dehydrate=function(){var r=this,n={};return Object.keys(r.storeInstances).forEach(function(e){var t=r.storeInstances[e];!t.dehydrate||t.shouldDehydrate&&!t.shouldDehydrate()||(n[e]=t.dehydrate())}),{stores:n}},Dt.prototype.rehydrate=function(n){var o=this;n.stores&&Object.keys(n.stores).forEach(function(e){var t=n.stores[e],r=o.getStore(e);r.rehydrate&&r.rehydrate(t)})},Dt.prototype.waitFor=function(e,t){if(!this.currentAction)throw new Error("waitFor called even though there is no action dispatching");this.currentAction.waitFor(e,t)};var Nt=Dt;function Lt(e){(e=e||{}).stores=e.stores||[],this.stores={},this.handlers={},this.handlers.default=[],this.hasWarnedAboutNameProperty=!1,e.stores.forEach(function(e){this.registerStore(e)},this)}Lt.prototype.createContext=function(e){return new Nt(this,e)},Lt.prototype.registerStore=function(r){if("function"!=typeof r)throw new Error("registerStore requires a constructor as first parameter");var n=this.getStoreName(r);if(!n)throw new Error("Store is required to have a `storeName` property.");if(this.stores[n]){if(this.stores[n]===r)return;throw new Error("Store with name `"+n+"` has already been registered.")}(this.stores[n]=r).handlers&&Object.keys(r.handlers).forEach(function(e){var t=r.handlers[e];this._registerHandler(e,n,t)},this)},Lt.prototype.isRegistered=function(e){var t=this.getStoreName(e),r=this.stores[t];return!!r&&("function"!=typeof e||e===r)},Lt.prototype.getStoreName=function(e){return"string"==typeof e?e:e.storeName?e.storeName:("production"!==process.env.NODE_ENV&&e.name&&!this.hasWarnedAboutNameProperty&&(console.warn("A store has been registered that relies on the constructor's name property. This name may change when you minify your stores during build time and could break string references to your store. It is advised that you add a static `storeName` property to your store to ensure the store name does not change during your build."),this.hasWarnedAboutNameProperty=!0),e.name)},Lt.prototype._registerHandler=function(e,t,r){return this.handlers[e]=this.handlers[e]||[],this.handlers[e].push({name:this.getStoreName(t),handler:r}),this.handlers.length-1};var It={createDispatcher:function(e){return new Lt(e)}},zt=a.module,Bt=[],Tt=!1,Ft=!0;function Rt(t){this.stores=[],this.dispatcherInstance=It.createDispatcher(),this.dispatcher=this.dispatcherInstance.createContext(),this.dispatch=function(){Bt.length&&console.warn("There are still stores not injected: "+Bt.join(",")+". Make sure to manually inject all stores before running any dispatches or set autoInjectStores to true."),this.dispatcher.dispatch.apply(this.dispatcher,arguments)},this.createStore=function(e,r){var n,o=function(t,r,n,o){function i(e){if(this.dispatcher=e,this.waitFor=function(e,t){if(e=Array.isArray(e)?e:[e],!o.areStoresRegistered(e))throw new Error("Waiting for stores that are not injected into Angular yet, "+e.join(", ")+". Be sure to inject stores before waiting for them");this.dispatcher.waitFor(e,t.bind(this))},!this.initialize)throw new Error("Store "+t+" does not have an initialize method which is is necessary to set the initial state");this.initialize()}return void 0===r&&(r={}),i.handlers=r.handlers,i.storeName=t,i.prototype.immutable=function(e,t){return void 0===t&&(t={}),this.__tree?this.__tree.set(e):this.__tree=new kt(e,a.extend({},n,t)),this.__tree},i.prototype.monkey=kt.monkey,Object.keys(r).forEach(function(e){i.prototype[e]=r[e]}),i}(e,r,t,this);if(o.exports={},this.dispatcherInstance.registerStore(o),this.stores.push(o),!r.exports)throw new Error("You have to add an exports object to your store: "+e);return n=this.dispatcher.getStore(o),Object.keys(r.exports).forEach(function(e){var t=Object.getOwnPropertyDescriptor(r.exports,e);t.get?Object.defineProperty(o.exports,e,{enumerable:t.enumerable,configurable:t.configurable,get:function(){return t.get.apply(n)}}):(o.exports[e]=function(){return r.exports[e].apply(n,arguments)},r.exports[e]=r.exports[e].bind(n))}),o.exports},this.getStore=function(t){var e=this.stores.filter(function(e){return e.exports===t})[0];return this.dispatcher.getStore(e)},this.areStoresRegistered=function(e){var t=this.stores.map(function(e){return e.storeName});return e.every(function(e){return-1<t.indexOf(e)})},this.reset=function(){this.dispatcherInstance.stores={},this.dispatcherInstance.handlers={},this.stores=[],Bt=[]},this.Baobab=kt}a.module=function(){var e=zt.apply(a,arguments);return e.store=function(n,o){return Bt.push(n),this.factory(n,["$injector","flux",function(e,t){var r=e.invoke(o);return Bt.splice(Bt.indexOf(n),1),t.createStore(n,r)}]),this},e},a.module("flux",[]).provider("flux",function(){var t={};this.setImmutableDefaults=function(e){t=e},this.autoInjectStores=function(e){Tt=e},this.useEvalAsync=function(e){Ft=e},this.$get=[function(){return new Rt(t)}]}).run(["$rootScope","$injector","flux",function(e,t,s){a.mock&&(Ft=!1,s.reset()),!a.mock&&Tt&&t.invoke(Bt.concat(a.noop)),e.constructor.prototype.$listenTo=function(e,t,r){var n,o,i=this,a=s.getStore(e);if(!a.__tree)throw new Error("Store "+e.storeName+" has not defined state with this.immutable() which is required in order to use $listenTo");n=r?a.__tree.select(t):(r=t,a.__tree),o=r,Ft&&(r=function(e){i.$evalAsync(function(){return o(e)})}),n.on("update",r),o({}),this.$on("$destroy",function(){return n.off("update",r)})}}]);return"flux"});
//# sourceMappingURL=flux-angular.umd.js.map
